{% extends "base.html" %}

{% block title %}Gestion utilisateurs - UzaMarket{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="section-title"><i class="fas fa-users me-2"></i>Gestion des utilisateurs</h2>
        <p class="text-muted mb-0">{{ users|length }} utilisateur{{ users|length|pluralize }}</p>
    </div>
    <a href="{% url 'core:admin_dashboard' %}" class="btn btn-outline-secondary btn-sm"><i class="fas fa-arrow-left me-1"></i>Retour</a>
</div>

<!-- Filtres par rôle -->
<div class="d-flex gap-2 mb-4">
    <a href="{% url 'core:admin_users' %}" class="btn btn-sm {% if not current_role %}btn-primary{% else %}btn-outline-secondary{% endif %}">Tous</a>
    <a href="{% url 'core:admin_users' %}?role=client" class="btn btn-sm {% if current_role == 'client' %}btn-primary{% else %}btn-outline-secondary{% endif %}">Clients</a>
    <a href="{% url 'core:admin_users' %}?role=seller" class="btn btn-sm {% if current_role == 'seller' %}btn-primary{% else %}btn-outline-secondary{% endif %}">Vendeurs</a>
    <a href="{% url 'core:admin_users' %}?role=admin" class="btn btn-sm {% if current_role == 'admin' %}btn-primary{% else %}btn-outline-secondary{% endif %}">Admins</a>
</div>

<div class="card border-0 shadow-sm" style="border-radius: 16px; overflow: hidden;">
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Utilisateur</th>
                    <th>Email</th>
                    <th>Rôle</th>
                    <th>Téléphone</th>
                    <th>Inscrit le</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar-placeholder me-2" style="width: 32px; height: 32px; font-size: 0.75rem;">{{ u.username|first|upper }}</div>
                            <strong>{{ u.username }}</strong>
                        </div>
                    </td>
                    <td><small>{{ u.email|default:"-" }}</small></td>
                    <td>
                        <span class="badge bg-{% if u.role == 'seller' %}primary{% elif u.role == 'admin' %}danger{% else %}secondary{% endif %}">
                            {{ u.get_role_display }}
                        </span>
                    </td>
                    <td><small>{{ u.phone|default:"-" }}</small></td>
                    <td><small>{{ u.date_joined|date:"d/m/Y" }}</small></td>
                    <td>
                        {% if u.is_active %}
                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>Actif</span>
                        {% else %}
                        <span class="badge bg-danger"><i class="fas fa-ban me-1"></i>Inactif</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if u != request.user %}
                        <form method="post" action="{% url 'core:admin_toggle_user' user_id=u.id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm {% if u.is_active %}btn-outline-danger{% else %}btn-outline-success{% endif %}" title="{% if u.is_active %}Désactiver{% else %}Activer{% endif %}">
                                <i class="fas fa-{% if u.is_active %}ban{% else %}check{% endif %}"></i>
                            </button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
